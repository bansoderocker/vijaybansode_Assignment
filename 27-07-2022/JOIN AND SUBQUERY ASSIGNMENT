USE NORTHWIND
--JOIN AND SUBQUERY ASSIGNMENT
--1 LIST ALL THE PRODUCTS DETAILS WHOSE CATEGORY IS SAME AS 'TOFU'
SELECT * FROM PRODUCTS WHERE CATEGORYID = (SELECT  CATEGORYID FROM PRODUCTS WHERE PRODUCTNAME = 'TOFU')

--2 LIST ALL THE PRODUCTS DETAILS FOR THE CATEGORY 'BEVERAGES'
SELECT * FROM PRODUCTS WHERE CATEGORYID = (SELECT  CATEGORYID FROM CATEGORIES WHERE CATEGORYNAME='BEVERAGES')

--3 LIST ALL THE ORDERS PLACED BY THE COMPANY NAME "ISLAND TRADING"
SELECT * FROM ORDERS WHERE CUSTOMERID = (SELECT CUSTOMERID FROM  CUSTOMERS WHERE COMPANYNAME = 'ISLAND TRADING')
	
--4 LIST COMPANY NAME AND NO OF ORDER COUNT PLACED BY EACH  COMPANY

SELECT C.COMPANYNAME,COUNT(ORDERID)[ORDER COUNT] FROM  CUSTOMERS C JOIN ORDERS O ON C.CUSTOMERID= O.CUSTOMERID
GROUP BY C.COMPANYNAME
--5 LIST ORDERID, CUSTOMER_COMAPNAYNAME FOR ALL THE ORDERS WHICH ARE HANDLE BY THE EMPLOYEES WHOSE TITLE IS "SALES MANAGER"
SELECT O.ORDERID, C.COMPANYNAME FROM ORDERS O JOIN CUSTOMERS C
ON C.CUSTOMERID= O.CUSTOMERID
JOIN EMPLOYEES E ON O.EMPLOYEEID = E.EMPLOYEEID
WHERE E.TITLE = 'SALES MANAGER'

--6 LIST 3RD HIGHEST COSTLIEST PRODUCT
SELECT ROW_NUMBER() OVER (ORDER BY UNITPRICE DESC) [SRNO],* INTO #PRODUCTPRICE FROM PRODUCTS 
SELECT * FROM #PRODUCTPRICE WHERE SRNO = 3
--7 FOR THE PRODUCT TABLE DISPLAY PRODUCTNAME AND CATEGORYNAME. ARRANGE AS PER THE CATEGORYNAME
SELECT P.PRODUCTNAME,C.CATEGORYNAME FROM PRODUCTS P JOIN CATEGORIES C ON P.CATEGORYID= C.CATEGORYID
ORDER BY C.CATEGORYNAME

--8 FOR THE ORDERS TABLE DISPLAY ORDERID CUSTOMER_COMPANYNAME AND EMPLOYEE_FULLNAME
SELECT O.ORDERID,C.COMPANYNAME,E.FIRSTNAME+' ' +E.LASTNAME AS FULLNAME FROM ORDERS O JOIN CUSTOMERS C ON O.CUSTOMERID = C.CUSTOMERID JOIN EMPLOYEES E ON E.EMPLOYEEID = O.EMPLOYEEID
--9 LIST ORDERID, EMPLOYEE_FULLNAME, CUSTOMER_COMPANYNAME, CATEGORYNAME, SUPPLIER_COMPANYNAME, PRODUCTNAME, ORDERDETAIS_UNIRPRICE, ORDERDETAILS_QUANTITY , NETSTOCK
SELECT O.ORDERID,E.FIRSTNAME+' ' +E.LASTNAME AS [EMPLOYEE_FULLNAME] ,C.COMPANYNAME[CUSTOMER_COMPANYNAME],CG.CATEGORYNAME[CATEGORYNAME],S.COMPANYNAME[SUPPLIER_COMPANYNAME],P.PRODUCTNAME[PRODUCTNAME],OD.UNITPRICE[ORDERDETAIS_UNIRPRICE],OD.QUANTITY[ORDERDETAILS_QUANTITY],P.UNITSINSTOCK [NETSTOCK]
FROM ORDERS O 
JOIN CUSTOMERS C ON O.CUSTOMERID = C.CUSTOMERID 
JOIN EMPLOYEES E ON E.EMPLOYEEID = O.EMPLOYEEID
JOIN [ORDER DETAILS] OD ON O.ORDERID = OD.ORDERID
JOIN PRODUCTS P ON P.PRODUCTID = OD.PRODUCTID
JOIN CATEGORIES CG ON P.CATEGORYID =CG.CATEGORYID
JOIN SUPPLIERS S ON S.SUPPLIERID = P.SUPPLIERID


--10 LIST ALL THE ORDERS (ORDERID, PRODUCTNAME) PLACED BY THE CUSTOMER IN LONDON 

SELECT O.ORDERID,P.PRODUCTNAME FROM ORDERS O
JOIN [ORDER DETAILS] OD ON O.ORDERID = OD.ORDERID
JOIN PRODUCTS P ON OD.PRODUCTID = P.PRODUCTID
JOIN CUSTOMERS C ON C.CUSTOMERID = O.CUSTOMERID
WHERE C.CITY = 'LONDON'

--11 FOR THE COSTLIEST PRODUCT DISPLAY PRODUCTNAME, UNITPRICE, CATEGORYNAME, SUPPLIER_CONTACTNAME
SELECT TOP 1 P.PRODUCTNAME,P.UNITPRICE, C.CATEGORYNAME, S.CONTACTNAME FROM PRODUCTS P 
JOIN SUPPLIERS S ON P.SUPPLIERID = S.SUPPLIERID
JOIN CATEGORIES C ON C.CATEGORYID = P.CATEGORYID
ORDER BY P.UNITPRICE DESC

--12 LIST ALL THE PRODUCTNAME WHOSE ORDER PLACED IN MONTH OF AUGUST
---*** DISTINCT ADDED ADDITIONALLY TO GET UNIQUE PRODUCTNAME
SELECT DISTINCT P.PRODUCTNAME FROM PRODUCTS P
JOIN [ORDER DETAILS] OD ON P.PRODUCTID = OD.PRODUCTID
JOIN ORDERS O ON O.ORDERID = OD.ORDERID
WHERE MONTH(ORDERDATE)= 8

--13 LIST ORDERID, QUANTITY FOR ALL THE ORDERS. ASSIGNED RANK AS PER THE HIGHEST OT LOWEST QUANTITY. DO NOT MISS ANY NUMBER WHILE ASSIGNING THE RANK
SELECT  RANK() OVER (ORDER BY QUANTITY DESC,ORDERID) AS [SRNO],ORDERID, QUANTITY FROM [ORDER DETAILS]

---SELECT  RANK() OVER (ORDER BY QUANTITY DESC) AS [SRNO],ORDERID, QUANTITY FROM [ORDER DETAILS]
---SELECT ROW_NUMBER() OVER (ORDER BY QUANTITY DESC)[ROW NUMBER], RANK() OVER (ORDER BY QUANTITY DESC) AS [SRNO],ORDERID, QUANTITY FROM [ORDER DETAILS]
--14 LIST ALL THE PRODUCTS FOR THE CATEGORY “DAIRY PRODUCT”
SELECT * FROM PRODUCTS WHERE CATEGORYID = (SELECT CATEGORYID  FROM CATEGORIES WHERE CATEGORYNAME='DAIRY PRODUCTS')
--15 LIST ALL THE PRODUCTS WHICH IS SUPPLIED BY THE COMPANY “BIGFOOT BREWERIES” FOR THE CATEGORY “BEVERAGES”
SELECT * FROM PRODUCTS WHERE CATEGORYID = (SELECT CATEGORYID  FROM CATEGORIES WHERE CATEGORYNAME='BEVERAGES')
AND SUPPLIERID= (SELECT SUPPLIERID FROM SUPPLIERS WHERE COMPANYNAME = 'BIGFOOT BREWERIES')
--16 PRINT CATEGORYNAME , SUPPLIER COMAPNY NAME AND PRODUCT COUNT FOR EACH CATEGORY AND SUPPLIER
------NOT SURE
SELECT C.CATEGORYNAME,S.COMPANYNAME, COUNT(P.CATEGORYID), COUNT(P.SUPPLIERID)  FROM PRODUCTS P JOIN CATEGORIES C ON P.CATEGORYID=C.CATEGORYID
JOIN SUPPLIERS S ON S.SUPPLIERID = P.SUPPLIERID
GROUP BY C.CATEGORYNAME,S.COMPANYNAME
--17 PRINT REGION AND TERRITORYDESCRIPTION NAME IN ASCENDING ORDER
SELECT R.*,T.TERRITORYDESCRIPTION FROM [DBO].[REGION] R JOIN [DBO].[TERRITORIES] T ON R.REGIONID = T.REGIONID

--18 PRINT EMPLOYEES NAME, REGION NAME, CITY AND COUNTRY --(CHECK FOR THE ERROR, NO REGION RELATIONSHIP)
--- 1ST WAY
SELECT E.FIRSTNAME+E.LASTNAME AS [FULLNAME],R.REGIONDESCRIPTION,E.CITY,E.COUNTRY FROM EMPLOYEES E 
JOIN EMPLOYEETERRITORIES ET ON ET.EMPLOYEEID = E.EMPLOYEEID
 JOIN TERRITORIES T ON ET.TERRITORYID = T.TERRITORYID
 JOIN REGION R ON R.REGIONID = T.REGIONID
----2ND WAY
 SELECT  E.FIRSTNAME+E.LASTNAME AS [FULLNAME],R.REGIONDESCRIPTION,E.CITY,E.COUNTRY 
 FROM [DBO].EMPLOYEES E LEFT JOIN REGION R ON E.REGION = R.REGIONDESCRIPTION
--19 FOR EACH CATEGORIES PRINT CATEGORYNAME AND SUPPLIERS NAME
SELECT P.PRODUCTNAME,C.CATEGORYNAME,S.CONTACTNAME FROM PRODUCTS P RIGHT JOIN CATEGORIES C ON P.CATEGORYID =C.CATEGORYID
JOIN SUPPLIERS S ON P.SUPPLIERID =S.SUPPLIERID
--20 PRINT EMPLOYEE TITLEOFCOURTESY, EMPLOYEE FIRST + LASTNAME ,EMPLOYEE TITLE, MANAGER TITLEOFCURTASY, MANAGER FIRSTNAME +LASTNAME, MANAGER TITLE
SELECT E.TITLEOFCOURTESY,E.FIRSTNAME+E.LASTNAME[EMPLOYEE FULL NAME],E.TITLE,M.TITLEOFCOURTESY, M.FIRSTNAME+M.LASTNAME[MANAGER FULL NAME],M.TITLE FROM EMPLOYEES E JOIN EMPLOYEES M ON E.REPORTSTO = M.EMPLOYEEID


